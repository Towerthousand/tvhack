function init(){var o="http://104.131.78.132:80/",e=o+"api/",t="u1";window.keyEnum={enter:13,rightArrow:39,leftArrow:37,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57};var n=["<video",'src="http://104.131.78.132:80/static/test.m3u8"','height="400" width="700"','id="vid" autoplay="true"',"onabort=\"console.log(' ABORT ')\"","oncanplay=\"console.log(' CAN PLAY ')\"","oncanplaythrough=\"console.log(' CAN PLAY THROUGH' )\"","oncuechange=\"console.log(' CUE CHANGE ')\"","ondurationchange=\"console.log(' DURATION CHANGE ')\"","onemptied=\"console.log(' EMPTIED ')\"","onended=\"console.log( 'ENDED' )\"","onerror=\"console.log(' ERROR' )\"","onloadeddata=\"console.log(' LOADED DATA ')\"","onloadedmetadata=\"console.log(' LOADED METADATA ')\"","onloadstart=\"console.log(' LOAD START ')\"","onpause=\"console.log(' PAUSE ')\"","onplay=\"console.log(' PLAY ')\"","onplaying=\"console.log(' PLAYING ')\"","onprogress=\"console.log(' PROGRESS ')\"","onratechange=\"console.log(' RATE CHANGE ')\"","onseeked=\"console.log(' SEEKED ')\"","onseeking=\"console.log(' SEEKING ')\"","onstalled=\"console.log(' STALLED ')\"","onsuspend=\"console.log(' SUSPEND ')\"","onvolumechange=\"console.log(' VOLUME CHANGE ')\"","onwaiting=\"console.log(' WAITING ')\">","</video>"].join(" ");document.body.className="";var l,a=function(o,e){navigator.setResolution&&navigator.setResolution(1280,720),navigator.setWebSecurityEnabled&&navigator.setWebSecurityEnabled(!1),window.onkeydown=this.handleControlKey,window.test=this,this.accordion={index:0},this.scope=o,this.state="",this.http=e,this.carers=[],this.inCall=!1;var t=l=this;this.stayAlive=setInterval(function(){t.populateCarers(),t.pingOnline(),t.populateCalling()},1e3),t.populateCarers(),t.pingOnline(),t.populateCalling()};a.prototype.populateCalling=function(){var o=this;this.http({method:"GET",url:e+"isCalling/"+t+"/"}).success(function(n,l,a,i){n.isCalling&&(o.inCall||(o.http({method:"GET",url:e+"uncall/"+t+"/"}),o.startCall()))})},a.prototype.startCall=function(){this.state="dialing",console.log(this.state),setTimeout(function(){return"dialing"==l.state?(console.log("Cancelling call"),l.state=""):void angular.element(document.getElementById("hotbod")).append(n)},5e3)},a.prototype.endCall=function(){self.inCall=!1},a.prototype.populateCarers=function(){var o=this;this.http({method:"GET",url:e+"isCaredBy/"+t+"/"}).success(function(e,t,n,l){if(o.carers.length)for(var a=0;a<o.carers.length;a++)o.carers[a].active=e.users[a].active;else o.carers=e.users})},a.prototype.handleControlKey=function(o){var e=o.keyCode;if(e==keyEnum.enter&&(l.startCall(),"accordion"==l.state)){l.carers[l.accordion.index]}39==e&&(l.accordion.index=(l.carers.length+l.accordion.index+1)%l.carers.length),47==e&&(l.accordion.index=(l.carers.length+l.accordion.index-1)%l.carers.length,o.preventDefault()),40==e&&(l.state=l.state?"":"accordion",o.preventDefault()),49==e&&"dialing"==l.state&&(l.state="connecting"),50==e&&"dialing"==l.state&&(l.state=""),l.scope.$apply()},a.prototype.pingOnline=function(){};var i,s=function(o,e){i=this,this.http=e,window.onkeydown=this.handleControlKey};s.prototype.handleControlKey=function(e){var t=e.keyCode;49==t&&i.http({method:"GET",url:"http://35.2.78.140:8080/itv/startURL?url=http://"+o+"call"})};var r=function(o){o.startSymbol("[["),o.endSymbol("]]")};angular.module("livesaver",[]).config(["$interpolateProvider",r]).controller("main",["$scope","$http",a]).controller("call",["$scope","$http",s]),angular.bootstrap(document.body,["livesaver"])}